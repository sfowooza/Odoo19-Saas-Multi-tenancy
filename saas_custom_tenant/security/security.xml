<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <data noupdate="1">
        <!-- SaaS Administrator Group -->
        <record id="group_saas_admin" model="res.groups">
            <field name="name">SaaS Administrator</field>
            <field name="comment">Full access to SaaS platform configuration and management</field>
            <field name="category_id" ref="base.module_category_extra_tools"/>
            <field name="implied_ids" eval="[(4, ref('base.group_user'))]"/>
        </record>

        <!-- SaaS User Group -->
        <record id="group_saas_user" model="res.groups">
            <field name="name">SaaS User</field>
            <field name="comment">Can manage tenant instances and view reports</field>
            <field name="category_id" ref="base.module_category_extra_tools"/>
            <field name="implied_ids" eval="[(4, ref('base.group_user'))]"/>
        </record>

        <!-- Portal User Group (for tenant access) -->
        <record id="group_saas_portal" model="res.groups">
            <field name="name">SaaS Portal</field>
            <field name="comment">Tenant users with portal access</field>
            <field name="category_id" ref="base.module_category_extra_tools"/>
            <field name="implied_ids" eval="[(4, ref('base.group_portal'))]"/>
        </record>

        <!-- Security Rules -->

        <!-- Tenant Instance - Users can only see their own instances -->
        <record id="rule_saas_tenant_instance_user" model="ir.rule">
            <field name="name">Tenant Instance: User Access</field>
            <field name="model_id" ref="model_saas_tenant_instance"/>
            <field name="domain_force">[('create_uid', '=', user.id)]</field>
            <field name="groups" eval="[(4, ref('group_saas_user'))]"/>
        </record>

        <!-- Tenant Usage - Users can only see their own usage -->
        <record id="rule_saas_tenant_usage_user" model="ir.rule">
            <field name="name">Tenant Usage: User Access</field>
            <field name="model_id" ref="model_saas_tenant_usage"/>
            <field name="domain_force">[('tenant_id.create_uid', '=', user.id)]</field>
            <field name="groups" eval="[(4, ref('group_saas_user'))]"/>
        </record>

        <!-- Portal users can only see their active tenant -->
        <record id="rule_saas_tenant_instance_portal" model="ir.rule">
            <field name="name">Tenant Instance: Portal Access</field>
            <field name="model_id" ref="model_saas_tenant_instance"/>
            <field name="domain_force">[('partner_id', '=', user.partner_id.id), ('state', '=', 'active')]</field>
            <field name="groups" eval="[(4, ref('group_saas_portal'))]"/>
        </record>
    </data>
</odoo>